"use strict";(self["webpackChunkel_admin_v2"]=self["webpackChunkel_admin_v2"]||[]).push([[262,82,601,595],{6082:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.dataForm.id?"编辑":"新增",visible:e.visible},on:{"update:visible":function(t){e.visible=t},close:e.resetDataForm}},[t("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"150px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmit()}}},[t("el-row",[t("el-form-item",{attrs:{label:"账号",prop:"account"}},[t("el-input",{model:{value:e.dataForm.account,callback:function(t){e.$set(e.dataForm,"account",t)},expression:"dataForm.account"}})],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"机构",prop:"deptName"}},[t("el-select",{attrs:{size:"mini"},model:{value:e.dataForm.deptName,callback:function(t){e.$set(e.dataForm,"deptName",t)},expression:"dataForm.deptName"}},[t("el-option",{attrs:{value:e.dataForm.deptName}},[t("el-tree",{attrs:{data:e.deptList,props:e.defaultProps,accordion:""},on:{"node-click":e.handleNodeClick}})],1)],1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:e.$t("角色"),prop:"userRole"}},[t("el-popover",{attrs:{placement:"bottom",width:"400",trigger:"click"}},[t("el-table",{ref:"table",staticClass:"table",attrs:{data:e.roleList},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",align:"center",width:"50"}}),t("el-table-column",{attrs:{property:"roleName",label:e.$t("sys.role.roleName"),align:"center"}}),t("el-table-column",{attrs:{property:"roleLevel",label:e.$t("sys.role.roleLevel"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",[e._v(e._s(e.getDictName(s.row.roleLevel)))])]}}])})],1),t("el-input",{attrs:{slot:"reference",type:"textarea",readonly:""},slot:"reference",model:{value:e.dataForm.userRole,callback:function(t){e.$set(e.dataForm,"userRole",t)},expression:"dataForm.userRole"}})],1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"管理机构",prop:"systemDept"}},[t("el-select",{attrs:{size:"mini"},model:{value:e.dataForm.systemDept,callback:function(t){e.$set(e.dataForm,"systemDept",t)},expression:"dataForm.systemDept"}},[t("el-option",{attrs:{value:e.dataForm.systemDept}},[t("el-tree",{ref:"tree",attrs:{"show-checkbox":"",data:e.deptList,"default-expanded-keys":e.ids,nodeKey:"id",props:e.defaultProps,accordion:""},on:{"check-change":e.handleNodeChange}})],1)],1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"邮箱",prop:"email",rules:"1"===e.dataForm.sendEmailFlag?e.dynamicRules.email:[]}},[t("el-input",{model:{value:e.dataForm.email,callback:function(t){e.$set(e.dataForm,"email",t)},expression:"dataForm.email"}})],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"电话",prop:"tel",rules:"1"===e.dataForm.sendflag?e.dynamicRules.tel:[]}},[t("el-input",{model:{value:e.dataForm.tel,callback:function(t){e.$set(e.dataForm,"tel",t)},expression:"dataForm.tel"}})],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"标志",prop:"flag"}},[t("el-select",{attrs:{size:"mini"},model:{value:e.dataForm.flag,callback:function(t){e.$set(e.dataForm,"flag",t)},expression:"dataForm.flag"}},e._l(e.statusList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1)],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),t("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmit()}}},[e._v("确定")])],1)],1)},a=[],l={components:{},mixins:[],props:{},data(){return{visible:!1,fullscreenLoading:!1,sendflagList:this.$store.getters["getDictList"]("dept.status"),sendEmailFlagList:this.$store.getters["getDictList"]("dept.status"),statusList:this.$store.getters["getDictList"]("dept.status"),clickStatu:!1,deptList:[],roleList:[],ids:[],selectedRole:[],selectedRoleId:[],defaultProps:{children:"children",label:"name"},dataForm:{id:"",name:"",deptId:"",account:"",deptName:"",systemDept:"",userRole:"",datas:[],roles:[],email:"",tel:"",sendEmailFlag:"1",sendflag:"1",flag:"1"},dataRule:{account:[{required:!0,message:this.$t("sys.role.account")+this.$t("info.common.notNull "),trigger:"blur"}],name:[{required:!0,message:this.$t("sys.role.name")+this.$t("info.common.notNull "),trigger:"blur"}],deptName:[{required:!0,message:this.$t("sys.role.deptName")+this.$t("info.common.notNull "),trigger:"change"}]},dynamicRules:{email:[{required:!0,message:this.$t("sys.role.emial")+this.$t("info.common.notNull "),trigger:"change"}],tel:[{required:!0,message:this.$t("sys.role.tel")+this.$t("info.common.notNull "),trigger:"change"}]}}},computed:{},created(){},mounted(){},methods:{init(e,t){this.ids=[],this.getDept(),this.getRole(),this.visible=!0,console.log(e),this.$nextTick((()=>{this.$refs.dataForm.resetFields(),this.$refs.tree.setCheckedKeys([]),e&&(this.getUserRoleDatas(e.id),this.dataForm=e||"",this.dataForm.roles=this.dataForm.userRole.split("，"),"copy"===t&&(this.dataForm.id=null))}))},resetDataForm(){this.dataForm={id:"",name:"",deptId:"",account:"",deptName:"",systemDept:"",userRole:"",datas:[],roles:[],email:"",tel:"",sendEmailFlag:"1",sendflag:"1",flag:"1"}},getDictName(e){return this.$store.getters["getDictName"]("user.level",e)},handleSelectionChange(e){this.selectedRole=e,this.dataForm.roles=e.map((e=>e.id));let t=e.map((e=>e.roleName));this.dataForm.userRole=t.join("，")},handleNodeClick(e){this.dataForm.deptId=e.id,this.dataForm.deptName=e.name},handleNodeChange(e){console.log(e);let t=this.$refs.tree.getCheckedNodes();this.dataForm.datas=t.map((e=>e.id));let s=t.map((e=>e.name));this.dataForm.systemDept=s.join("，")},getUserRoleDatas(e){let t={};t={userId:e,language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$http({url:"/service/user/list",method:"post",data:t,contentType:"json"}).then((e=>{0===e.code?(this.nestToSimple(e.data.datas),this.dataForm.datas=this.ids,this.$nextTick((()=>{this.$refs.tree.setCheckedKeys(this.ids)}))):this.$message(this.$t(e.msg))}))},nestToSimple(e){e.forEach((e=>{e.state&&this.ids.push(e.id),e.children&&e.children.length>0&&this.nestToSimple(e.children)}))},getDept(){let e={};e={language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$http({url:"/service/dept/getDepts",method:"post",data:e,contentType:"json"}).then((e=>{0===e.code?(this.deptList=e.data,this.dataForm.systemDept=this.dataForm):this.$message(this.$t(e.msg))}))},getRole(){let e={};e={language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us",pageSize:"99999",pageNo:"1"},this.$http({url:"/service/role/list",method:"post",data:e,contentType:"json"}).then((e=>{if(0===e.code){this.roleList=e.data.result;for(let e in this.dataForm.roles)for(let t in this.roleList)this.dataForm.roles[e].replace(/^\s*|\s*$/g,"")===this.roleList[t].roleName&&this.$nextTick((()=>{this.$refs.table.toggleRowSelection(this.roleList[t],!0)}))}else this.$message(this.$t(e.msg))}))},getUserRole(){},dataFormSubmit(){this.clickStatu||(this.clickStatu=!0,this.$refs["dataForm"].validate((e=>{if(e){this.fullscreenLoading=!0;let e={};e={id:this.dataForm.id||null,deptId:this.dataForm.deptId,datas:this.dataForm.datas,roles:this.dataForm.roles,name:this.dataForm.name,account:this.dataForm.account,email:this.dataForm.email,tel:this.dataForm.tel,sendEmailFlag:this.dataForm.sendEmailFlag,sendflag:this.dataForm.sendflag,flag:this.dataForm.flag,language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$http({url:"/service/user/save",method:"post",data:e,contentType:"json"}).then((e=>{e&&0===e.code?(this.visible=!1,this.$emit("refreshDataList"),this.$message({message:this.$t("operateSuccess"),type:"success",duration:1500,onClose:()=>{this.clickStatu=!1,this.fullscreenLoading=!1}})):this.$message({message:this.$t(e.msg),type:"error",duration:1500,onClose:()=>{this.clickStatu=!1,this.fullscreenLoading=!1}})}))}}))),setTimeout((()=>{this.clickStatu=!1,this.fullscreenLoading=!1}),1500)}},filters:{},watch:{}},o=l,r=s(3736),n=(0,r.Z)(o,i,a,!1,null,"abc4ed7e",null),d=n.exports},2601:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.$t("select"),"close-on-click-modal":!1,visible:e.visible},on:{close:e.closeHandle,"update:visible":function(t){e.visible=t}}},[t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{staticStyle:{"margin-bottom":"20px"},on:{click:e.download}},[e._v("下载导入模板文件(Excel)")])],1),t("el-upload",{staticStyle:{"text-align":"center"},attrs:{drag:"",action:e.action,"before-upload":e.beforeUploadHandle,"on-success":e.successHandle,multiple:"","file-list":e.fileList,accept:e.acceptList}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v(" 将文件拖到此处，或 "),t("em",[e._v("点击导入")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只支持导入excel文件！")])])],1)},a=[],l={props:{acceptList:{type:String,default:".xlsx,.xls"},importUrl:String},data(){return{visible:!1,url:"",num:0,successNum:0,fileList:[],query:"",fileUploadPath:"",fileName:""}},computed:{dataObj(){return{tellerId:this.$store.state.user.account,optUser:this.$store.state.user.name,fileName:this.fileName,filePath:this.fileUploadPath,language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"}},action(){return"/api/SystemFileUploadServlet?path="+this.fileUploadPath}},methods:{init(){this.visible=!0,this.$http({url:"/service/user/getTemplateFile",method:"post",data:{language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},contentType:"json"}).then((e=>{this.query="fileName="+e.data.fileName+"&filePath="+e.data.filePath,this.fileUploadPath=e.data.fileUploadPath,this.fileUploadPath.replace(/\\/g,"/"),this.fileName=e.data.fileName,console.log(this.query),e&&0===e.code?console.log():this.$message(this.$t(e.msg))}))},download(){window.location.href="/api//service/systemfile/downloadFile?"+this.query},beforeUploadHandle(e){if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!==e.type&&"application/vnd.ms-excel"!==e.type)return this.$message.error("只支持上传excel文件！"),!1;this.num++},successHandle(e,t,s){this.fileList=s,this.successNum++,this.$http({url:"/service/user/import",method:"post",data:this.dataObj,contentType:"json"}).then((e=>{e&&0===e.code?this.num===this.successNum&&this.$confirm("操作成功, 是否继续操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((()=>{this.visible=!1})):this.$message(this.$t(e.msg))}))},closeHandle(){this.fileList=[],this.$emit("refreshDataList")}}},o=l,r=s(3736),n=(0,r.Z)(o,i,a,!1,null,"c9627798",null),d=n.exports},262:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"userList"}},[t("grid",{ref:"user",attrs:{api:e.api,columns:e.columns,model:e.dataForm,multiSelectedArr:e.multipleSelection,rowKey:"id","has-tree":""},on:{"update:model":function(t){e.dataForm=t},"update:multiSelectedArr":function(t){e.multipleSelection=t},"update:multi-selected-arr":function(t){e.multipleSelection=t}}},[t("div",{attrs:{slot:"form"},slot:"form"},[t("el-form-item",{attrs:{label:"账号"}},[t("el-input",{attrs:{size:"mini",placeholder:"账号",clearable:""},model:{value:e.dataForm.account,callback:function(t){e.$set(e.dataForm,"account",t)},expression:"dataForm.account"}})],1),t("el-form-item",{attrs:{label:"姓名"}},[t("el-input",{attrs:{size:"mini",placeholder:"姓名",clearable:""},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),t("btn-list",{attrs:{slot:"toolbar",data:e.btnList},on:{click:e.action},slot:"toolbar"})],1),e.addOrUpdateVisible?t("add-or-update",{ref:"addOrUpdate",on:{refreshDataList:e.refresh}}):e._e(),e.SetGroupVisible?t("set-group",{ref:"setGroup",on:{refreshDataList:e.refresh}}):e._e(),e.importVisible?t("import-user-info",{ref:"importUserInfo",on:{refreshDataList:e.refresh}}):e._e()],1)},a=[],l=s(6082),o=s(6595),r=s(2601),n={name:"userList",components:{AddOrUpdate:l["default"],SetGroup:o["default"],ImportUserInfo:r["default"]},mixins:[],props:{},data(){this.$createElement;return{api:"/service/user/getPage",addOrUpdateVisible:!1,SetGroupVisible:!1,importVisible:!1,multipleSelection:[],dataForm:{account:"",name:"",treeDeptId:""},columns:[{type:"selection",width:50},{label:"机构",prop:"deptName"},{label:"账号",prop:"account"},{label:"名称",prop:"name"},{label:"手机号",prop:"tel",minWidth:"100"},{label:"邮件",prop:"email"},{label:"标志",render(e,{row:t}){const s=e("span",[this.$store.getters["getDictName"]("status",t.flag)]);return[s]}},{label:"角色",prop:"userRole",minWidth:200}],dataListSelections:[]}},computed:{btnList(){return this.$store.getters.getPermissionsByCode("management.user")},stateList(){return this.$store.getters["getDictList"]("dept.status")}},created(){},mounted(){},methods:{action(e){const t=!(!e||!this[e]);t?this[e]():this.$message("该功能暂未支持,请联系管理员确认配置是否出错！")},add(){this.addOrUpdateVisible=!0,this.$nextTick((()=>{this.$refs.addOrUpdate.init()}))},edit(){if(0===this.multipleSelection.length)this.$message({message:this.$t("info.common.selectmore"),type:"warning",duration:1500});else if(1===this.multipleSelection.length){this.addOrUpdateVisible=!0;let e={};this.$refs.user.list.forEach((t=>{t.id===this.multipleSelection[0].id&&(e=JSON.parse(JSON.stringify(t)))})),this.$nextTick((()=>{this.$refs.addOrUpdate.init(e)}))}else this.$message({message:this.$t("info.common.selectone"),type:"warning",duration:1500})},copy(){if(0===this.multipleSelection.length)this.$message({message:this.$t("info.common.selectmore"),type:"warning",duration:1500});else if(1===this.multipleSelection.length){this.addOrUpdateVisible=!0;let e={};this.$refs.user.list.forEach((t=>{t.id===this.multipleSelection[0].id&&(e=JSON.parse(JSON.stringify(t)))})),this.$nextTick((()=>{this.$refs.addOrUpdate.init(e,"copy")}))}else this.$message({message:this.$t("info.common.selectone"),type:"warning",duration:1500})},del(e){var t=e?[e]:this.multipleSelection.map((e=>e.id));let s={};s={ids:t,language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$confirm(this.$t("info.common.delete"),this.$t("提示")).then((()=>{this.$http({url:"/service/user/del",method:"post",data:s,contentType:"json"}).then((e=>{e&&0===e.code?(this.refresh(),this.$message({message:this.$t("info.common.deletesuccess"),type:"success",duration:1500,onClose:()=>{}})):this.$message.error(this.$t(e.msg))}))}))},refresh(){this.$refs.user.getDataList()},exportData(){},resetpassword(){0===this.multipleSelection.length?this.$message({message:this.$t("info.common.selectmore"),type:"warning",duration:1500}):1===this.multipleSelection.length?this.$confirm(this.$t("info.password.reset"),this.$t("提示")).then((()=>{let e={};e={id:this.multipleSelection[0].id,language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$http({url:"/service/user/resetPassword",method:"post",data:e,contentType:"json"}).then((e=>{e&&0===e.code?(this.refresh(),this.$message({message:this.$t("operateSuccess"),type:"success",duration:1500,onClose:()=>{}})):this.$message.error(this.$t(e.msg))}))})):this.$message({message:this.$t("info.common.selectone"),type:"warning",duration:1500})},setgroup(){if(0===this.multipleSelection.length)this.$message({message:this.$t("info.common.selectmore"),type:"warning",duration:1500});else if(1===this.multipleSelection.length){this.SetGroupVisible=!0;let e={};this.$refs.user.list.forEach((t=>{t.id===this.multipleSelection[0].id&&(e=JSON.parse(JSON.stringify(t)))})),this.$nextTick((()=>{this.$refs.setGroup.init(e)}))}else this.$message({message:this.$t("info.common.selectone"),type:"warning",duration:1500})},importUserInfo(){this.importVisible=!0,this.$nextTick((()=>{this.$refs.importUserInfo.init()}))}},filters:{},watch:{btnList:{immediate:!0,handler(e){console.log(e.map((e=>e.code)))}},dataListSelections(e){console.log(e)}}},d=n,c=s(3736),m=(0,c.Z)(d,i,a,!1,null,"894002de",null),h=m.exports},6595:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:this.$t("window.view"),visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[t("h2",{staticClass:"info-title"},[e._v(e._s(e.$t("feelview.term.group.sendGroup")))]),e._l(e.groupList,(function(s){return t("el-col",{key:s.groupId,attrs:{span:8}},[t("el-checkbox",{attrs:{label:s.groupName},model:{value:s.check,callback:function(t){e.$set(s,"check",t)},expression:"item.check"}})],1)})),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),t("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmit()}}},[e._v("确定")])],1)],2)},a=[],l={components:{},mixins:[],props:{},data(){return{visible:!1,fullscreenLoading:!1,clickStatu:!1,groupList:[],checkList:[],userId:""}},computed:{},created(){},mounted(){},methods:{init(e){this.visible=!0,this.userId=e.id,this.getNoPage(e)},getNoPage(e){let t={};t={userId:e.id,deptId:e.deptId,language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$http({url:"/service/devGroup/getNoPage",method:"post",data:t,contentType:"json"}).then((e=>{if(e&&0===e.resultCode){this.groupList=e.data.allData,this.checkList=e.data.data;for(let e of this.groupList)for(let t of this.checkList)e.groupId===t.groupId&&this.$set(e,"check",!0)}else this.$message(this.$t(e.msg))}))},dataFormSubmit(){if(!this.clickStatu){this.clickStatu=!0,this.fullscreenLoading=!0;let e=this.groupList.filter((e=>e.check)).map((e=>e.groupId)),t={};t={userId:this.userId,ids:e,language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$http({url:"/service/devGroup/saveGroupPrivi",method:"post",data:t,contentType:"json"}).then((e=>{console.log(e),e&&0===e.resultCode?(this.visible=!1,this.$emit("refreshDataList"),this.$message({message:this.$t("operateSuccess"),type:"success",duration:1500,onClose:()=>{this.clickStatu=!1,this.fullscreenLoading=!1}})):this.$message({message:this.$t(e.resultMsg),type:"error",duration:1500,onClose:()=>{this.clickStatu=!1,this.fullscreenLoading=!1}})}))}setTimeout((()=>{this.clickStatu=!1,this.fullscreenLoading=!1}),1500)}},filters:{},watch:{}},o=l,r=s(3736),n=(0,r.Z)(o,i,a,!1,null,"6a134f31",null),d=n.exports}}]);
//# sourceMappingURL=262.9a51b185.js.map