"use strict";(self["webpackChunkel_admin_v2"]=self["webpackChunkel_admin_v2"]||[]).push([[82],{6082:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.dataForm.id?"编辑":"新增",visible:e.visible},on:{"update:visible":function(t){e.visible=t},close:e.resetDataForm}},[t("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"150px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dataFormSubmit()}}},[t("el-row",[t("el-form-item",{attrs:{label:"账号",prop:"account"}},[t("el-input",{model:{value:e.dataForm.account,callback:function(t){e.$set(e.dataForm,"account",t)},expression:"dataForm.account"}})],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"机构",prop:"deptName"}},[t("el-select",{attrs:{size:"mini"},model:{value:e.dataForm.deptName,callback:function(t){e.$set(e.dataForm,"deptName",t)},expression:"dataForm.deptName"}},[t("el-option",{attrs:{value:e.dataForm.deptName}},[t("el-tree",{attrs:{data:e.deptList,props:e.defaultProps,accordion:""},on:{"node-click":e.handleNodeClick}})],1)],1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:e.$t("角色"),prop:"userRole"}},[t("el-popover",{attrs:{placement:"bottom",width:"400",trigger:"click"}},[t("el-table",{ref:"table",staticClass:"table",attrs:{data:e.roleList},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",align:"center",width:"50"}}),t("el-table-column",{attrs:{property:"roleName",label:e.$t("sys.role.roleName"),align:"center"}}),t("el-table-column",{attrs:{property:"roleLevel",label:e.$t("sys.role.roleLevel"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.getDictName(a.row.roleLevel)))])]}}])})],1),t("el-input",{attrs:{slot:"reference",type:"textarea",readonly:""},slot:"reference",model:{value:e.dataForm.userRole,callback:function(t){e.$set(e.dataForm,"userRole",t)},expression:"dataForm.userRole"}})],1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"管理机构",prop:"systemDept"}},[t("el-select",{attrs:{size:"mini"},model:{value:e.dataForm.systemDept,callback:function(t){e.$set(e.dataForm,"systemDept",t)},expression:"dataForm.systemDept"}},[t("el-option",{attrs:{value:e.dataForm.systemDept}},[t("el-tree",{ref:"tree",attrs:{"show-checkbox":"",data:e.deptList,"default-expanded-keys":e.ids,nodeKey:"id",props:e.defaultProps,accordion:""},on:{"check-change":e.handleNodeChange}})],1)],1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"邮箱",prop:"email",rules:"1"===e.dataForm.sendEmailFlag?e.dynamicRules.email:[]}},[t("el-input",{model:{value:e.dataForm.email,callback:function(t){e.$set(e.dataForm,"email",t)},expression:"dataForm.email"}})],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"电话",prop:"tel",rules:"1"===e.dataForm.sendflag?e.dynamicRules.tel:[]}},[t("el-input",{model:{value:e.dataForm.tel,callback:function(t){e.$set(e.dataForm,"tel",t)},expression:"dataForm.tel"}})],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"标志",prop:"flag"}},[t("el-select",{attrs:{size:"mini"},model:{value:e.dataForm.flag,callback:function(t){e.$set(e.dataForm,"flag",t)},expression:"dataForm.flag"}},e._l(e.statusList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1)],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),t("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:function(t){return e.dataFormSubmit()}}},[e._v("确定")])],1)],1)},l=[],o={components:{},mixins:[],props:{},data(){return{visible:!1,fullscreenLoading:!1,sendflagList:this.$store.getters["getDictList"]("dept.status"),sendEmailFlagList:this.$store.getters["getDictList"]("dept.status"),statusList:this.$store.getters["getDictList"]("dept.status"),clickStatu:!1,deptList:[],roleList:[],ids:[],selectedRole:[],selectedRoleId:[],defaultProps:{children:"children",label:"name"},dataForm:{id:"",name:"",deptId:"",account:"",deptName:"",systemDept:"",userRole:"",datas:[],roles:[],email:"",tel:"",sendEmailFlag:"1",sendflag:"1",flag:"1"},dataRule:{account:[{required:!0,message:this.$t("sys.role.account")+this.$t("info.common.notNull "),trigger:"blur"}],name:[{required:!0,message:this.$t("sys.role.name")+this.$t("info.common.notNull "),trigger:"blur"}],deptName:[{required:!0,message:this.$t("sys.role.deptName")+this.$t("info.common.notNull "),trigger:"change"}]},dynamicRules:{email:[{required:!0,message:this.$t("sys.role.emial")+this.$t("info.common.notNull "),trigger:"change"}],tel:[{required:!0,message:this.$t("sys.role.tel")+this.$t("info.common.notNull "),trigger:"change"}]}}},computed:{},created(){},mounted(){},methods:{init(e,t){this.ids=[],this.getDept(),this.getRole(),this.visible=!0,console.log(e),this.$nextTick((()=>{this.$refs.dataForm.resetFields(),this.$refs.tree.setCheckedKeys([]),e&&(this.getUserRoleDatas(e.id),this.dataForm=e||"",this.dataForm.roles=this.dataForm.userRole.split("，"),"copy"===t&&(this.dataForm.id=null))}))},resetDataForm(){this.dataForm={id:"",name:"",deptId:"",account:"",deptName:"",systemDept:"",userRole:"",datas:[],roles:[],email:"",tel:"",sendEmailFlag:"1",sendflag:"1",flag:"1"}},getDictName(e){return this.$store.getters["getDictName"]("user.level",e)},handleSelectionChange(e){this.selectedRole=e,this.dataForm.roles=e.map((e=>e.id));let t=e.map((e=>e.roleName));this.dataForm.userRole=t.join("，")},handleNodeClick(e){this.dataForm.deptId=e.id,this.dataForm.deptName=e.name},handleNodeChange(e){console.log(e);let t=this.$refs.tree.getCheckedNodes();this.dataForm.datas=t.map((e=>e.id));let a=t.map((e=>e.name));this.dataForm.systemDept=a.join("，")},getUserRoleDatas(e){let t={};t={userId:e,language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$http({url:"/service/user/list",method:"post",data:t,contentType:"json"}).then((e=>{0===e.code?(this.nestToSimple(e.data.datas),this.dataForm.datas=this.ids,this.$nextTick((()=>{this.$refs.tree.setCheckedKeys(this.ids)}))):this.$message(this.$t(e.msg))}))},nestToSimple(e){e.forEach((e=>{e.state&&this.ids.push(e.id),e.children&&e.children.length>0&&this.nestToSimple(e.children)}))},getDept(){let e={};e={language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$http({url:"/service/dept/getDepts",method:"post",data:e,contentType:"json"}).then((e=>{0===e.code?(this.deptList=e.data,this.dataForm.systemDept=this.dataForm):this.$message(this.$t(e.msg))}))},getRole(){let e={};e={language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us",pageSize:"99999",pageNo:"1"},this.$http({url:"/service/role/list",method:"post",data:e,contentType:"json"}).then((e=>{if(0===e.code){this.roleList=e.data.result;for(let e in this.dataForm.roles)for(let t in this.roleList)this.dataForm.roles[e].replace(/^\s*|\s*$/g,"")===this.roleList[t].roleName&&this.$nextTick((()=>{this.$refs.table.toggleRowSelection(this.roleList[t],!0)}))}else this.$message(this.$t(e.msg))}))},getUserRole(){},dataFormSubmit(){this.clickStatu||(this.clickStatu=!0,this.$refs["dataForm"].validate((e=>{if(e){this.fullscreenLoading=!0;let e={};e={id:this.dataForm.id||null,deptId:this.dataForm.deptId,datas:this.dataForm.datas,roles:this.dataForm.roles,name:this.dataForm.name,account:this.dataForm.account,email:this.dataForm.email,tel:this.dataForm.tel,sendEmailFlag:this.dataForm.sendEmailFlag,sendflag:this.dataForm.sendflag,flag:this.dataForm.flag,language:"zh"===this.$store.state.i18n.locale?"zh_CN":"en_us"},this.$http({url:"/service/user/save",method:"post",data:e,contentType:"json"}).then((e=>{e&&0===e.code?(this.visible=!1,this.$emit("refreshDataList"),this.$message({message:this.$t("operateSuccess"),type:"success",duration:1500,onClose:()=>{this.clickStatu=!1,this.fullscreenLoading=!1}})):this.$message({message:this.$t(e.msg),type:"error",duration:1500,onClose:()=>{this.clickStatu=!1,this.fullscreenLoading=!1}})}))}}))),setTimeout((()=>{this.clickStatu=!1,this.fullscreenLoading=!1}),1500)}},filters:{},watch:{}},i=o,r=a(3736),n=(0,r.Z)(i,s,l,!1,null,"abc4ed7e",null),d=n.exports}}]);
//# sourceMappingURL=82.a0f347f5.js.map